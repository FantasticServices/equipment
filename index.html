            APP_STATE.maintenance.push(maintenance);
            
            if (APP_STATE.currentSection === 'maintenance') {
                renderMaintenanceTable();
            }
            
            // Update alerts
            loadAlertsData().then(() => {
                updateDashboard();
            });
            
            closeModal('maintenanceModal');
            showToast('Maintenance logged successfully!', 'success');
            
            // Simulate sync with Google Sheets
            syncMaintenanceToSheets(maintenance);
        }

        function handlePATTest(e) {
            e.preventDefault();
            
            const pat = {
                id: generateTestID(),
                itemId: document.getElementById('patEquipment').value,
                lastTest: document.getElementById('patDate').value,
                nextDue: calculateNextDueDate(document.getElementById('patDate').value, 12), // 12 months
                result: document.getElementById('patResult').value,
                tester: document.getElementById('patTester').value,
                certificate: document.getElementById('patCertificate').value,
                visual: document.getElementById('patVisual').value,
                earth: document.getElementById('patEarth').value,
                insulation: document.getElementById('patInsulation').value
            };

            APP_STATE.patTesting.push(pat);
            
            if (APP_STATE.currentSection === 'pat-testing') {
                renderPATTable();
            }
            
            // Update alerts
            loadAlertsData().then(() => {
                updateDashboard();
            });
            
            // Show critical alert for failed tests
            if (pat.result === 'Fail') {
                const equipment = APP_STATE.equipment.find(eq => eq.itemId === pat.itemId);
                showToast(`CRITICAL: ${equipment?.name || pat.itemId} failed PAT test and must be taken out of service immediately!`, 'error', 10000);
            }
            
            closeModal('patModal');
            showToast('PAT test recorded successfully!', 'success');
            
            // Simulate sync with Google Sheets
            syncPATToSheets(pat);
        }

        function handleSaveSettings(e) {
            e.preventDefault();
            
            APP_STATE.settings = {
                maintenanceWarning: parseInt(document.getElementById('maintenanceWarning').value),
                patWarning: parseInt(document.getElementById('patWarning').value),
                emailRecipients: document.getElementById('emailRecipients').value
            };
            
            APP_STATE.sheetsUrl = document.getElementById('sheetsUrl').value;
            
            // Save to localStorage
            localStorage.setItem('equipmentSettings', JSON.stringify(APP_STATE.settings));
            localStorage.setItem('sheetsUrl', APP_STATE.sheetsUrl);
            
            showToast('Settings saved successfully!', 'success');
        }

        // Utility Functions
        function generateItemID() {
            const existingIds = APP_STATE.equipment.map(eq => parseInt(eq.itemId.substring(2)));
            const nextId = Math.max(0, ...existingIds) + 1;
            return `EQ${nextId.toString().padStart(3, '0')}`;
        }

        function generateMaintenanceID() {
            const existingIds = APP_STATE.maintenance.map(m => parseInt(m.id.substring(3)));
            const nextId = Math.max(0, ...existingIds) + 1;
            return `MNT${nextId.toString().padStart(3, '0')}`;
        }

        function generateTestID() {
            const existingIds = APP_STATE.patTesting.map(p => parseInt(p.id.substring(3)));
            const nextId = Math.max(0, ...existingIds) + 1;
            return `PAT${nextId.toString().padStart(3, '0')}`;
        }

        function calculateNextDueDate(lastDate, monthsToAdd) {
            const date = new Date(lastDate);
            date.setMonth(date.getMonth() + monthsToAdd);
            return date.toISOString().split('T')[0];
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-GB');
        }

        function showToast(message, type = 'info', duration = 3000) {
            // Create toast element
            const toast = document.createElement('div');
            toast.className = `alert alert-${type}`;
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 10000;
                min-width: 300px;
                animation: slideIn 0.3s ease;
            `;
            toast.innerHTML = `<strong>${message}</strong>`;
            
            document.body.appendChild(toast);
            
            // Remove after duration
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => document.body.removeChild(toast), 300);
            }, duration);
        }

        // Google Sheets Integration Functions
        async function syncWithSheets() {
            showToast('Syncing with Google Sheets...', 'info');
            
            try {
                // In a real implementation, these would be actual API calls
                await Promise.all([
                    syncAllEquipmentToSheets(),
                    syncAllMaintenanceToSheets(),
                    syncAllPATToSheets()
                ]);
                
                showToast('Sync completed successfully!', 'success');
            } catch (error) {
                console.error('Sync error:', error);
                showToast('Sync failed. Please check your connection and permissions.', 'error');
            }
        }

        async function syncEquipmentToSheets(equipment) {
            // Simulate API call to Google Sheets
            console.log('Syncing equipment to sheets:', equipment);
            
            // In real implementation:
            // 1. Authenticate with Google Sheets API
            // 2. Extract sheet ID from URL
            // 3. Append row to Equipment Inventory sheet
            
            return new Promise(resolve => setTimeout(resolve, 500));
        }

        async function syncMaintenanceToSheets(maintenance) {
            console.log('Syncing maintenance to sheets:', maintenance);
            return new Promise(resolve => setTimeout(resolve, 500));
        }

        async function syncPATToSheets(pat) {
            console.log('Syncing PAT test to sheets:', pat);
            return new Promise(resolve => setTimeout(resolve, 500));
        }

        async function syncAllEquipmentToSheets() {
            for (const equipment of APP_STATE.equipment) {
                await syncEquipmentToSheets(equipment);
            }
        }

        async function syncAllMaintenanceToSheets() {
            for (const maintenance of APP_STATE.maintenance) {
                await syncMaintenanceToSheets(maintenance);
            }
        }

        async function syncAllPATToSheets() {
            for (const pat of APP_STATE.patTesting) {
                await syncPATToSheets(pat);
            }
        }

        // Data refresh function
        async function refreshData() {
            showToast('Refreshing data...', 'info');
            
            try {
                // In real implementation, this would fetch from Google Sheets
                await loadInitialData();
                
                // Refresh current section
                loadSectionData(APP_STATE.currentSection);
                
                showToast('Data refreshed successfully!', 'success');
            } catch (error) {
                console.error('Refresh error:', error);
                showToast('Failed to refresh data', 'error');
            }
        }

        // Report Generation Functions
        function generateMonthlyReport() {
            showToast('Generating monthly report...', 'info');
            
            // Create report data
            const reportData = {
                period: new Date().toLocaleDateString('en-GB', { month: 'long', year: 'numeric' }),
                totalEquipment: APP_STATE.equipment.length,
                maintenanceActivities: APP_STATE.maintenance.length,
                patTests: APP_STATE.patTesting.length,
                activeAlerts: APP_STATE.alerts.length,
                totalValue: APP_STATE.equipment.reduce((sum, eq) => sum + (eq.cost || 0), 0)
            };
            
            // Generate report content
            const reportHTML = `
                <div style="padding: 20px; background: white; border-radius: 8px; margin: 20px 0;">
                    <h2>Monthly Equipment Report - ${reportData.period}</h2>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0;">
                        <div style="text-align: center; padding: 20px; background: #f8fafc; border-radius: 8px;">
                            <h3>${reportData.totalEquipment}</h3>
                            <p>Total Equipment</p>
                        </div>
                        <div style="text-align: center; padding: 20px; background: #f8fafc; border-radius: 8px;">
                            <h3>${reportData.maintenanceActivities}</h3>
                            <p>Maintenance Activities</p>
                        </div>
                        <div style="text-align: center; padding: 20px; background: #f8fafc; border-radius: 8px;">
                            <h3>${reportData.patTests}</h3>
                            <p>PAT Tests</p>
                        </div>
                        <div style="text-align: center; padding: 20px; background: #f8fafc; border-radius: 8px;">
                            <h3>¬£${reportData.totalValue.toLocaleString()}</h3>
                            <p>Total Value</p>
                        </div>
                    </div>
                </div>
            `;
            
            // Open in new window for printing
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>Monthly Equipment Report</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
                            h2 { color: #1f2937; margin-bottom: 20px; }
                            h3 { color: #2563eb; margin: 0; font-size: 24px; }
                            p { margin: 5px 0 0 0; color: #64748b; }
                        </style>
                    </head>
                    <body>
                        ${reportHTML}
                        <script>window.print();</script>
                    </body>
                </html>
            `);
            
            showToast('Monthly report generated!', 'success');
        }

        function generateDepreciationReport() {
            showToast('Generating depreciation report...', 'info');
            
            const depreciationData = APP_STATE.equipment.map(equipment => {
                const purchaseDate = new Date(equipment.purchaseDate);
                const today = new Date();
                const ageInYears = (today - purchaseDate) / (365.25 * 24 * 60 * 60 * 1000);
                const annualDepreciationRate = 0.2; // 20% per year
                const totalDepreciation = Math.min(equipment.cost * annualDepreciationRate * ageInYears, equipment.cost);
                const currentValue = Math.max(equipment.cost - totalDepreciation, 0);
                
                return {
                    ...equipment,
                    ageInYears: Math.round(ageInYears * 100) / 100,
                    totalDepreciation: Math.round(totalDepreciation),
                    currentValue: Math.round(currentValue)
                };
            });
            
            const reportHTML = `
                <div style="padding: 20px; background: white; border-radius: 8px; margin: 20px 0;">
                    <h2>Equipment Depreciation Report</h2>
                    <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                        <thead>
                            <tr style="background: #f8fafc;">
                                <th style="padding: 10px; border: 1px solid #e2e8f0; text-align: left;">Equipment</th>
                                <th style="padding: 10px; border: 1px solid #e2e8f0; text-align: right;">Purchase Cost</th>
                                <th style="padding: 10px; border: 1px solid #e2e8f0; text-align: right;">Age (Years)</th>
                                <th style="padding: 10px; border: 1px solid #e2e8f0; text-align: right;">Depreciation</th>
                                <th style="padding: 10px; border: 1px solid #e2e8f0; text-align: right;">Current Value</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${depreciationData.map(item => `
                                <tr>
                                    <td style="padding: 10px; border: 1px solid #e2e8f0;">${item.name}</td>
                                    <td style="padding: 10px; border: 1px solid #e2e8f0; text-align: right;">¬£${item.cost.toLocaleString()}</td>
                                    <td style="padding: 10px; border: 1px solid #e2e8f0; text-align: right;">${item.ageInYears}</td>
                                    <td style="padding: 10px; border: 1px solid #e2e8f0; text-align: right;">¬£${item.totalDepreciation.toLocaleString()}</td>
                                    <td style="padding: 10px; border: 1px solid #e2e8f0; text-align: right;">¬£${item.currentValue.toLocaleString()}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>Depreciation Report</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
                            h2 { color: #1f2937; margin-bottom: 20px; }
                            table { border-collapse: collapse; width: 100%; }
                            th, td { border: 1px solid #e2e8f0; padding: 8px; }
                            th { background: #f8fafc; font-weight: bold; }
                        </style>
                    </head>
                    <body>
                        ${reportHTML}
                        <script>window.print();</script>
                    </body>
                </html>
            `);
            
            showToast('Depreciation report generated!', 'success');
        }

        function viewServiceHistory() {
            // Switch to maintenance section
            switchSection('maintenance');
            showToast('Showing service history', 'info');
        }

        function exportData() {
            showToast('Preparing data export...', 'info');
            
            // Create CSV data
            const csvData = {
                equipment: APP_STATE.equipment,
                maintenance: APP_STATE.maintenance,
                patTesting: APP_STATE.patTesting
            };
            
            // Convert to CSV format
            const equipmentCSV = convertToCSV(csvData.equipment);
            const maintenanceCSV = convertToCSV(csvData.maintenance);
            const patCSV = convertToCSV(csvData.patTesting);
            
            // Create download links
            downloadCSV(equipmentCSV, 'equipment_inventory.csv');
            downloadCSV(maintenanceCSV, 'maintenance_log.csv');
            downloadCSV(patCSV, 'pat_testing.csv');
            
            showToast('Data exported successfully!', 'success');
        }

        function convertToCSV(data) {
            if (data.length === 0) return '';
            
            const headers = Object.keys(data[0]);
            const csvContent = [
                headers.join(','),
                ...data.map(row => 
                    headers.map(header => {
                        const value = row[header] || '';
                        return typeof value === 'string' && value.includes(',') ? `"${value}"` : value;
                    }).join(',')
                )
            ].join('\n');
            
            return csvContent;
        }

        function downloadCSV(csvContent, filename) {
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', filename);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }

        // Additional Action Functions
        function editEquipment(itemId) {
            const equipment = APP_STATE.equipment.find(eq => eq.itemId === itemId);
            if (equipment) {
                // Populate form with existing data
                document.getElementById('equipmentName').value = equipment.name;
                document.getElementById('equipmentCategory').value = equipment.category;
                document.getElementById('equipmentBrand').value = equipment.brand || '';
                document.getElementById('equipmentSerial').value = equipment.serial || '';
                document.getElementById('equipmentPurchaseDate').value = equipment.purchaseDate || '';
                document.getElementById('equipmentCost').value = equipment.cost || '';
                document.getElementById('equipmentCondition').value = equipment.condition;
                document.getElementById('equipmentAssigned').value = equipment.assignedTo || '';
                document.getElementById('equipmentWarranty').value = equipment.warranty || '';
                document.getElementById('equipmentSupplier').value = equipment.supplier || '';
                
                openModal('addEquipmentModal');
            }
        }

        function viewEquipmentDetails(itemId) {
            const equipment = APP_STATE.equipment.find(eq => eq.itemId === itemId);
            const maintenanceHistory = APP_STATE.maintenance.filter(m => m.itemId === itemId);
            const patHistory = APP_STATE.patTesting.filter(p => p.itemId === itemId);
            
            if (equipment) {
                const detailsHTML = `
                    <div style="max-width: 800px; margin: 20px auto; padding: 20px; background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                        <h2>${equipment.name} (${equipment.itemId})</h2>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                            <div>
                                <h3>Equipment Details</h3>
                                <p><strong>Category:</strong> ${equipment.category}</p>
                                <p><strong>Brand/Model:</strong> ${equipment.brand || 'N/A'}</p>
                                <p><strong>Serial Number:</strong> ${equipment.serial || 'N/A'}</p>
                                <p><strong>Condition:</strong> <span class="status-badge ${equipment.condition.toLowerCase()}">${equipment.condition}</span></p>
                                <p><strong>Assigned To:</strong> ${equipment.assignedTo || 'N/A'}</p>
                            </div>
                            <div>
                                <h3>Financial Information</h3>
                                <p><strong>Purchase Date:</strong> ${formatDate(equipment.purchaseDate)}</p>
                                <p><strong>Purchase Cost:</strong> ¬£${equipment.cost?.toLocaleString() || '0'}</p>
                                <p><strong>Warranty Expiry:</strong> ${equipment.warranty ? formatDate(equipment.warranty) : 'N/A'}</p>
                                <p><strong>Supplier:</strong> ${equipment.supplier || 'N/A'}</p>
                            </div>
                        </div>
                        
                        <div style="margin: 30px 0;">
                            <h3>Maintenance History (${maintenanceHistory.length} records)</h3>
                            ${maintenanceHistory.length > 0 ? `
                                <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                                    <thead>
                                        <tr style="background: #f8fafc;">
                                            <th style="padding: 8px; border: 1px solid #e2e8f0; text-align: left;">Date</th>
                                            <th style="padding: 8px; border: 1px solid #e2e8f0; text-align: left;">Type</th>
                                            <th style="padding: 8px; border: 1px solid #e2e8f0; text-align: left;">Provider</th>
                                            <th style="padding: 8px; border: 1px solid #e2e8f0; text-align: right;">Cost</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${maintenanceHistory.map(m => `
                                            <tr>
                                                <td style="padding: 8px; border: 1px solid #e2e8f0;">${formatDate(m.lastService)}</td>
                                                <td style="padding: 8px; border: 1px solid #e2e8f0;">${m.type}</td>
                                                <td style="padding: 8px; border: 1px solid #e2e8f0;">${m.provider || 'N/A'}</td>
                                                <td style="padding: 8px; border: 1px solid #e2e8f0; text-align: right;">¬£${m.cost?.toLocaleString() || '0'}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            ` : '<p>No maintenance history available</p>'}
                        </div>
                        
                        <div style="margin: 30px 0;">
                            <h3>PAT Testing History (${patHistory.length} records)</h3>
                            ${patHistory.length > 0 ? `
                                <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                                    <thead>
                                        <tr style="background: #f8fafc;">
                                            <th style="padding: 8px; border: 1px solid #e2e8f0; text-align: left;">Test Date</th>
                                            <th style="padding: 8px; border: 1px solid #e2e8f0; text-align: left;">Result</th>
                                            <th style="padding: 8px; border: 1px solid #e2e8f0; text-align: left;">Tester</th>
                                            <th style="padding: 8px; border: 1px solid #e2e8f0; text-align: left;">Certificate</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${patHistory.map(p => `
                                            <tr>
                                                <td style="padding: 8px; border: 1px solid #e2e8f0;">${formatDate(p.lastTest)}</td>
                                                <td style="padding: 8px; border: 1px solid #e2e8f0;"><span class="status-badge ${p.result.toLowerCase()}">${p.result}</span></td>
                                                <td style="padding: 8px; border: 1px solid #e2e8f0;">${p.tester}</td>
                                                <td style="padding: 8px; border: 1px solid #e2e8f0;">${p.certificate || 'N/A'}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            ` : '<p>No PAT testing history available</p>'}
                        </div>
                    </div>
                `;
                
                const detailsWindow = window.open('', '_blank');
                detailsWindow.document.write(`
                    <html>
                        <head>
                            <title>Equipment Details - ${equipment.name}</title>
                            <style>
                                body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f8fafc; }
                                h2, h3 { color: #1f2937; }
                                table { border-collapse: collapse; width: 100%; }
                                th, td { border: 1px solid #e2e8f0; padding: 8px; }
                                th { background: #f8fafc; font-weight: bold; }
                                .status-badge { padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: bold; }
                                .status-badge.excellent { background: #dcfce7; color: #166534; }
                                .status-badge.good { background: #dbeafe; color: #1e40af; }
                                .status-badge.fair { background: #fef3c7; color: #92400e; }
                                .status-badge.poor { background: #fee2e2; color: #991b1b; }
                                .status-badge.pass { background: #dcfce7; color: #166534; }
                                .status-badge.fail { background: #fee2e2; color: #991b1b; }
                            </style>
                        </head>
                        <body>
                            ${detailsHTML}
                            <div style="text-align: center; margin: 30px 0;">
                                <button onclick="window.print()" style="padding: 10px 20px; background: #2563eb; color: white; border: none; border-radius: 8px; cursor: pointer;">Print Details</button>
                                <button onclick="window.close()" style="padding: 10px 20px; background: #6b7280; color: white; border: none; border-radius: 8px; cursor: pointer; margin-left: 10px;">Close</button>
                            </div>
                        </body>
                    </html>
                `);
            }
        }

        function viewAllAlerts() {
            switchSection('alerts');
        }

        function editMaintenance(maintenanceId) {
            showToast('Edit maintenance functionality coming soon!', 'info');
        }

        function editPATTest(testId) {
            showToast('Edit PAT test functionality coming soon!', 'info');
        }

        function retestEquipment(itemId) {
            // Pre-fill PAT test form for retesting
            document.getElementById('patForm').reset();
            document.getElementById('patEquipment').value = itemId;
            document.getElementById('patDate').value = new Date().toISOString().split('T')[0];
            openModal('patModal');
            showToast('Please record the retest results', 'info');
        }

        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
            
            .fade-in {
                animation: fadeIn 0.3s ease;
            }
            
            .pulse {
                animation: pulse 2s infinite;
            }
            
            @keyframes pulse {
                0% { transform: scale(1); }
                50% { transform: scale(1.05); }
                100% { transform: scale(1); }
            }
        `;
        document.head.appendChild(style);

        // Initialize tooltips and help text
        function initializeTooltips() {
            // Add helpful tooltips to form fields
            const tooltips = {
                'equipmentCondition': 'Select the current physical condition of the equipment',
                'maintenanceType': 'Choose the type of maintenance being performed',
                'patResult': 'Record whether the equipment passed or failed the PAT test',
                'patTester': 'Name of the qualified person who performed the test'
            };
            
            Object.entries(tooltips).forEach(([id, text]) => {
                const element = document.getElementById(id);
                if (element) {
                    element.title = text;
                }
            });
        }

        // Call initialization functions
        setTimeout(initializeTooltips, 1000);

        // Add keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + R for refresh
            if ((e.ctrlKey || e.metaKey) && e.key === 'r') {
                e.preventDefault();
                refreshData();
            }
            
            // Ctrl/Cmd + S for sync
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                syncWithSheets();
            }
            
            // Escape to close modals
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal.active').forEach(modal => {
                    modal.classList.remove('active');
                });
            }
        });

        // Auto-save form data
        function setupAutoSave() {
            const forms = ['addEquipmentForm', 'maintenanceForm', 'patForm'];
            
            forms.forEach(formId => {
                const form = document.getElementById(formId);
                if (form) {
                    form.addEventListener('input', function(e) {
                        const formData = new FormData(form);
                        const data = Object.fromEntries(formData);
                        localStorage.setItem(`autosave_${formId}`, JSON.stringify(data));
                    });
                }
            });
        }

        // Load auto-saved data
        function loadAutoSavedData() {
            const forms = ['addEquipmentForm', 'maintenanceForm', 'patForm'];
            
            forms.forEach(formId => {
                const savedData = localStorage.getItem(`autosave_${formId}`);
                if (savedData) {
                    try {
                        const data = JSON.parse(savedData);
                        const form = document.getElementById(formId);
                        if (form) {
                            Object.entries(data).forEach(([key, value]) => {
                                const field = form.querySelector(`[name="${key}"]`);
                                if (field) field.value = value;
                            });
                        }
                    } catch (error) {
                        console.error('Error loading auto-saved data:', error);
                    }
                }
            });
        }

        // Call setup functions
        setTimeout(() => {
            setupAutoSave();
            loadAutoSavedData();
        }, 1000);

        // Add service worker for offline functionality (basic)
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').catch(err => {
                console.log('Service worker registration failed:', err);
            });
        }

        console.log('Equipment Management Web Application loaded successfully!');
    </script>
</body>
</html><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Equipment Management System - Fantastic Services</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #2563eb;
            --secondary-color: #10b981;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --dark-color: #1f2937;
            --light-gray: #f8fafc;
            --border-color: #e2e8f0;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--text-primary);
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: white;
            box-shadow: var(--shadow-lg);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
            transition: transform 0.3s ease;
        }

        .sidebar.collapsed {
            transform: translateX(-100%);
        }

        .sidebar-header {
            padding: 24px 20px;
            border-bottom: 1px solid var(--border-color);
            background: var(--primary-color);
            color: white;
        }

        .sidebar-header h1 {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .sidebar-header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .nav-menu {
            padding: 20px 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.2s ease;
            cursor: pointer;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
        }

        .nav-item:hover {
            background: var(--light-gray);
            color: var(--primary-color);
        }

        .nav-item.active {
            background: var(--primary-color);
            color: white;
            border-right: 3px solid var(--secondary-color);
        }

        .nav-item-icon {
            margin-right: 12px;
            font-size: 18px;
            width: 20px;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 280px;
            background: var(--light-gray);
            min-height: 100vh;
            transition: margin-left 0.3s ease;
        }

        .main-content.expanded {
            margin-left: 0;
        }

        .header {
            background: white;
            padding: 20px 30px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
        }

        .header-left {
            display: flex;
            align-items: center;
        }

        .mobile-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 20px;
            margin-right: 15px;
            cursor: pointer;
            color: var(--text-primary);
        }

        .page-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: #1d4ed8;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: var(--secondary-color);
            color: white;
        }

        .btn-secondary:hover {
            background: #059669;
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
        }

        .btn-outline {
            background: white;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
        }

        .btn-outline:hover {
            background: var(--primary-color);
            color: white;
        }

        /* Content Area */
        .content {
            padding: 30px;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Dashboard Cards */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            transition: transform 0.2s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
        }

        .stat-card-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 16px;
        }

        .stat-card-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }

        .stat-card-icon.primary { background: var(--primary-color); }
        .stat-card-icon.secondary { background: var(--secondary-color); }
        .stat-card-icon.warning { background: var(--warning-color); }
        .stat-card-icon.danger { background: var(--danger-color); }

        .stat-card-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .stat-card-label {
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* Forms */
        .form-container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            max-width: 800px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        /* Tables */
        .table-container {
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .table-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th {
            background: var(--light-gray);
            padding: 16px 24px;
            text-align: left;
            font-weight: 600;
            color: var(--text-primary);
            border-bottom: 1px solid var(--border-color);
        }

        .table td {
            padding: 16px 24px;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-secondary);
        }

        .table tbody tr:hover {
            background: var(--light-gray);
        }

        /* Status Badges */
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-badge.excellent { background: #dcfce7; color: #166534; }
        .status-badge.good { background: #dbeafe; color: #1e40af; }
        .status-badge.fair { background: #fef3c7; color: #92400e; }
        .status-badge.poor { background: #fee2e2; color: #991b1b; }
        .status-badge.pass { background: #dcfce7; color: #166534; }
        .status-badge.fail { background: #fee2e2; color: #991b1b; }

        /* Alerts */
        .alert {
            padding: 16px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .alert-success {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }

        .alert-warning {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fde68a;
        }

        .alert-danger {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        /* Loading States */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-color);
            border-top: 2px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 12px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            animation: fadeIn 0.2s ease;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .mobile-toggle {
                display: block;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .header {
                padding: 15px 20px;
            }

            .content {
                padding: 20px;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .table-container {
                overflow-x: auto;
            }
        }

        /* Print Styles */
        @media print {
            .sidebar, .header-actions, .mobile-toggle {
                display: none;
            }

            .main-content {
                margin-left: 0;
            }

            .content {
                padding: 0;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h1>Equipment Manager</h1>
                <p>Fantastic Services</p>
            </div>
            <div class="nav-menu">
                <button class="nav-item active" data-section="dashboard">
                    <span class="nav-item-icon">üìä</span>
                    Dashboard
                </button>
                <button class="nav-item" data-section="equipment">
                    <span class="nav-item-icon">üîß</span>
                    Equipment
                </button>
                <button class="nav-item" data-section="maintenance">
                    <span class="nav-item-icon">‚öôÔ∏è</span>
                    Maintenance
                </button>
                <button class="nav-item" data-section="pat-testing">
                    <span class="nav-item-icon">‚ö°</span>
                    PAT Testing
                </button>
                <button class="nav-item" data-section="alerts">
                    <span class="nav-item-icon">üö®</span>
                    Alerts
                </button>
                <button class="nav-item" data-section="reports">
                    <span class="nav-item-icon">üìã</span>
                    Reports
                </button>
                <button class="nav-item" data-section="settings">
                    <span class="nav-item-icon">‚öôÔ∏è</span>
                    Settings
                </button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content" id="mainContent">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <button class="mobile-toggle" id="mobileToggle">‚ò∞</button>
                    <h1 class="page-title" id="pageTitle">Dashboard</h1>
                </div>
                <div class="header-actions">
                    <button class="btn btn-outline" onclick="refreshData()">
                        üîÑ Refresh
                    </button>
                    <button class="btn btn-primary" onclick="syncWithSheets()">
                        üìä Sync Sheets
                    </button>
                </div>
            </header>

            <!-- Content Sections -->
            <div class="content">
                <!-- Dashboard Section -->
                <section class="content-section active" id="dashboard">
                    <div class="dashboard-grid">
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div class="stat-card-icon primary">üîß</div>
                            </div>
                            <div class="stat-card-value" id="totalEquipment">0</div>
                            <div class="stat-card-label">Total Equipment</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div class="stat-card-icon warning">‚ö†Ô∏è</div>
                            </div>
                            <div class="stat-card-value" id="maintenanceDue">0</div>
                            <div class="stat-card-label">Maintenance Due</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div class="stat-card-icon danger">‚ö°</div>
                            </div>
                            <div class="stat-card-value" id="patDue">0</div>
                            <div class="stat-card-label">PAT Tests Due</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div class="stat-card-icon secondary">üí∞</div>
                            </div>
                            <div class="stat-card-value" id="totalValue">¬£0</div>
                            <div class="stat-card-label">Total Equipment Value</div>
                        </div>
                    </div>

                    <!-- Recent Alerts -->
                    <div class="table-container">
                        <div class="table-header">
                            <h2 class="table-title">Recent Alerts</h2>
                            <button class="btn btn-outline" onclick="viewAllAlerts()">View All</button>
                        </div>
                        <div id="recentAlerts" class="loading">
                            <div class="spinner"></div>
                            Loading alerts...
                        </div>
                    </div>
                </section>

                <!-- Equipment Section -->
                <section class="content-section" id="equipment">
                    <div class="table-container">
                        <div class="table-header">
                            <h2 class="table-title">Equipment Inventory</h2>
                            <button class="btn btn-primary" onclick="addEquipment()">
                                ‚ûï Add Equipment
                            </button>
                        </div>
                        <div id="equipmentTable" class="loading">
                            <div class="spinner"></div>
                            Loading equipment...
                        </div>
                    </div>
                </section>

                <!-- Maintenance Section -->
                <section class="content-section" id="maintenance">
                    <div class="table-container">
                        <div class="table-header">
                            <h2 class="table-title">Maintenance Log</h2>
                            <button class="btn btn-primary" onclick="logMaintenance()">
                                ‚ûï Log Maintenance
                            </button>
                        </div>
                        <div id="maintenanceTable" class="loading">
                            <div class="spinner"></div>
                            Loading maintenance records...
                        </div>
                    </div>
                </section>

                <!-- PAT Testing Section -->
                <section class="content-section" id="pat-testing">
                    <div class="table-container">
                        <div class="table-header">
                            <h2 class="table-title">PAT Testing Records</h2>
                            <button class="btn btn-primary" onclick="recordPATTest()">
                                ‚ûï Record PAT Test
                            </button>
                        </div>
                        <div id="patTable" class="loading">
                            <div class="spinner"></div>
                            Loading PAT records...
                        </div>
                    </div>
                </section>

                <!-- Alerts Section -->
                <section class="content-section" id="alerts">
                    <div id="alertsContent">
                        <div class="loading">
                            <div class="spinner"></div>
                            Loading alerts...
                        </div>
                    </div>
                </section>

                <!-- Reports Section -->
                <section class="content-section" id="reports">
                    <div class="dashboard-grid">
                        <div class="stat-card">
                            <h3>Monthly Report</h3>
                            <p>Generate comprehensive monthly equipment report</p>
                            <button class="btn btn-primary" onclick="generateMonthlyReport()">Generate</button>
                        </div>
                        <div class="stat-card">
                            <h3>Depreciation Report</h3>
                            <p>Calculate current equipment values and depreciation</p>
                            <button class="btn btn-secondary" onclick="generateDepreciationReport()">Generate</button>
                        </div>
                        <div class="stat-card">
                            <h3>Service History</h3>
                            <p>View detailed service history for equipment</p>
                            <button class="btn btn-outline" onclick="viewServiceHistory()">View</button>
                        </div>
                        <div class="stat-card">
                            <h3>Export Data</h3>
                            <p>Export equipment data to various formats</p>
                            <button class="btn btn-outline" onclick="exportData()">Export</button>
                        </div>
                    </div>
                </section>

                <!-- Settings Section -->
                <section class="content-section" id="settings">
                    <div class="form-container">
                        <h2>System Settings</h2>
                        <form id="settingsForm">
                            <div class="form-group">
                                <label class="form-label">Google Sheets URL</label>
                                <input type="url" class="form-input" id="sheetsUrl" 
                                       value="https://docs.google.com/spreadsheets/d/1LdjdPqRvjbPyulxqBimsh9QELIVm_S5mgkY6l-XIgfg/edit">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Maintenance Warning (days)</label>
                                    <input type="number" class="form-input" id="maintenanceWarning" value="30">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">PAT Warning (days)</label>
                                    <input type="number" class="form-input" id="patWarning" value="30">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Email Recipients</label>
                                <input type="email" class="form-input" id="emailRecipients" 
                                       value="bqc@fantasticservices.com, antonia.harbalieva@fantasticservices.com">
                            </div>
                            <button type="submit" class="btn btn-primary">Save Settings</button>
                        </form>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div class="modal" id="addEquipmentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Add New Equipment</h2>
                <button class="modal-close" onclick="closeModal('addEquipmentModal')">&times;</button>
            </div>
            <form id="addEquipmentForm">
                <div class="form-group">
                    <label class="form-label">Equipment Name *</label>
                    <input type="text" class="form-input" id="equipmentName" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Category *</label>
                        <select class="form-input" id="equipmentCategory" required>
                            <option value="">Select Category</option>
                            <option value="Vacuum Cleaners">Vacuum Cleaners</option>
                            <option value="Carpet Cleaners">Carpet Cleaners</option>
                            <option value="Pressure Washers">Pressure Washers</option>
                            <option value="Floor Polishers">Floor Polishers</option>
                            <option value="Window Cleaning">Window Cleaning</option>
                            <option value="Cleaning Supplies">Cleaning Supplies</option>
                            <option value="Safety Equipment">Safety Equipment</option>
                            <option value="Tools">Tools</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Condition *</label>
                        <select class="form-input" id="equipmentCondition" required>
                            <option value="">Select Condition</option>
                            <option value="Excellent">Excellent</option>
                            <option value="Good">Good</option>
                            <option value="Fair">Fair</option>
                            <option value="Poor">Poor</option>
                            <option value="Requires Repair">Requires Repair</option>
                            <option value="Out of Service">Out of Service</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Brand/Model</label>
                        <input type="text" class="form-input" id="equipmentBrand">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Serial Number</label>
                        <input type="text" class="form-input" id="equipmentSerial">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Purchase Date</label>
                        <input type="date" class="form-input" id="equipmentPurchaseDate">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Purchase Cost (¬£)</label>
                        <input type="number" class="form-input" id="equipmentCost" step="0.01">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Assigned To</label>
                        <input type="text" class="form-input" id="equipmentAssigned">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Warranty Expiry</label>
                        <input type="date" class="form-input" id="equipmentWarranty">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Supplier Contact</label>
                    <input type="text" class="form-input" id="equipmentSupplier">
                </div>
                <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
                    <button type="button" class="btn btn-outline" onclick="closeModal('addEquipmentModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Equipment</button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal" id="maintenanceModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Log Maintenance</h2>
                <button class="modal-close" onclick="closeModal('maintenanceModal')">&times;</button>
            </div>
            <form id="maintenanceForm">
                <div class="form-group">
                    <label class="form-label">Equipment *</label>
                    <select class="form-input" id="maintenanceEquipment" required>
                        <option value="">Select Equipment</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Service Type *</label>
                        <select class="form-input" id="maintenanceType" required>
                            <option value="">Select Type</option>
                            <option value="Routine Maintenance">Routine Maintenance</option>
                            <option value="Emergency Repair">Emergency Repair</option>
                            <option value="Preventive Service">Preventive Service</option>
                            <option value="Calibration">Calibration</option>
                            <option value="Cleaning">Cleaning</option>
                            <option value="Parts Replacement">Parts Replacement</option>
                            <option value="Warranty Service">Warranty Service</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Service Date *</label>
                        <input type="date" class="form-input" id="maintenanceDate" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Service Provider</label>
                        <input type="text" class="form-input" id="maintenanceProvider">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Cost (¬£)</label>
                        <input type="number" class="form-input" id="maintenanceCost" step="0.01">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-input" id="maintenanceDescription" rows="3"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Parts Replaced</label>
                        <input type="text" class="form-input" id="maintenanceParts">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Invoice Reference</label>
                        <input type="text" class="form-input" id="maintenanceInvoice">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Technician Notes</label>
                    <textarea class="form-input" id="maintenanceNotes" rows="3"></textarea>
                </div>
                <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
                    <button type="button" class="btn btn-outline" onclick="closeModal('maintenanceModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Log Maintenance</button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal" id="patModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Record PAT Test</h2>
                <button class="modal-close" onclick="closeModal('patModal')">&times;</button>
            </div>
            <form id="patForm">
                <div class="form-group">
                    <label class="form-label">Equipment *</label>
                    <select class="form-input" id="patEquipment" required>
                        <option value="">Select Equipment</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Test Date *</label>
                        <input type="date" class="form-input" id="patDate" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Test Result *</label>
                        <select class="form-input" id="patResult" required>
                            <option value="">Select Result</option>
                            <option value="Pass">Pass</option>
                            <option value="Fail">Fail</option>
                            <option value="Not Applicable">Not Applicable</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Tester Name *</label>
                        <input type="text" class="form-input" id="patTester" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Certificate Reference</label>
                        <input type="text" class="form-input" id="patCertificate">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Visual Inspection</label>
                        <select class="form-input" id="patVisual">
                            <option value="">Select</option>
                            <option value="Pass">Pass</option>
                            <option value="Fail">Fail</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Earth Bond Test</label>
                        <select class="form-input" id="patEarth">
                            <option value="">Select</option>
                            <option value="Pass">Pass</option>
                            <option value="Fail">Fail</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Insulation Test</label>
                    <select class="form-input" id="patInsulation">
                        <option value="">Select</option>
                        <option value="Pass">Pass</option>
                        <option value="Fail">Fail</option>
                    </select>
                </div>
                <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
                    <button type="button" class="btn btn-outline" onclick="closeModal('patModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Record Test</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Application State
        const APP_STATE = {
            currentSection: 'dashboard',
            equipment: [],
            maintenance: [],
            patTesting: [],
            alerts: [],
            sheetsUrl: 'https://docs.google.com/spreadsheets/d/1LdjdPqRvjbPyulxqBimsh9QELIVm_S5mgkY6l-XIgfg/edit',
            settings: {
                maintenanceWarning: 30,
                patWarning: 30,
                emailRecipients: 'bqc@fantasticservices.com, antonia.harbalieva@fantasticservices.com'
            }
        };

        // Initialize Application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            loadInitialData();
        });

        function initializeApp() {
            // Load settings from localStorage
            const savedSettings = localStorage.getItem('equipmentSettings');
            if (savedSettings) {
                APP_STATE.settings = { ...APP_STATE.settings, ...JSON.parse(savedSettings) };
            }

            // Set today's date as default for forms
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('maintenanceDate').value = today;
            document.getElementById('patDate').value = today;
        }

        function setupEventListeners() {
            // Navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function() {
                    const section = this.getAttribute('data-section');
                    switchSection(section);
                });
            });

            // Mobile toggle
            document.getElementById('mobileToggle').addEventListener('click', function() {
                const sidebar = document.getElementById('sidebar');
                sidebar.classList.toggle('active');
            });

            // Form submissions
            document.getElementById('addEquipmentForm').addEventListener('submit', handleAddEquipment);
            document.getElementById('maintenanceForm').addEventListener('submit', handleLogMaintenance);
            document.getElementById('patForm').addEventListener('submit', handlePATTest);
            document.getElementById('settingsForm').addEventListener('submit', handleSaveSettings);

            // Close modals when clicking outside
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.classList.remove('active');
                    }
                });
            });
        }

        function switchSection(sectionName) {
            // Update navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-section="${sectionName}"]`).classList.add('active');

            // Update content
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionName).classList.add('active');

            // Update page title
            const titles = {
                'dashboard': 'Dashboard',
                'equipment': 'Equipment Inventory',
                'maintenance': 'Maintenance Log',
                'pat-testing': 'PAT Testing',
                'alerts': 'Alerts',
                'reports': 'Reports',
                'settings': 'Settings'
            };
            document.getElementById('pageTitle').textContent = titles[sectionName];

            APP_STATE.currentSection = sectionName;

            // Load section-specific data
            loadSectionData(sectionName);
        }

        async function loadInitialData() {
            showToast('Loading data...', 'info');
            
            try {
                // Simulate API calls to Google Sheets
                await Promise.all([
                    loadEquipmentData(),
                    loadMaintenanceData(),
                    loadPATData(),
                    loadAlertsData()
                ]);

                updateDashboard();
                showToast('Data loaded successfully', 'success');
            } catch (error) {
                console.error('Error loading data:', error);
                showToast('Error loading data. Please check your connection.', 'error');
            }
        }

        async function loadEquipmentData() {
            // Simulate API call to Google Sheets
            // In real implementation, this would use Google Sheets API
            const sampleEquipment = [
                {
                    itemId: 'EQ001',
                    name: 'Dyson V15 Vacuum',
                    category: 'Vacuum Cleaners',
                    brand: 'Dyson V15 Detect',
                    serial: 'DV15001',
                    purchaseDate: '2023-01-15',
                    cost: 450,
                    condition: 'Good',
                    assignedTo: 'John Smith',
                    warranty: '2024-01-15',
                    supplier: 'Dyson Support'
                },
                {
                    itemId: 'EQ002',
                    name: 'Carpet Cleaner Pro',
                    category: 'Carpet Cleaners',
                    brand: 'Bissell ProHeat 2X',
                    serial: 'BH2X002',
                    purchaseDate: '2023-03-20',
                    cost: 299,
                    condition: 'Fair',
                    assignedTo: 'Jane Doe',
                    warranty: '2024-03-20',
                    supplier: 'Bissell Service'
                },
                {
                    itemId: 'EQ003',
                    name: 'Pressure Washer',
                    category: 'Pressure Washers',
                    brand: 'Karcher K5 Premium',
                    serial: 'KK5003',
                    purchaseDate: '2023-06-10',
                    cost: 280,
                    condition: 'Excellent',
                    assignedTo: 'Mike Johnson',
                    warranty: '2024-06-10',
                    supplier: 'Karcher UK'
                },
                {
                    itemId: 'EQ004',
                    name: 'Floor Polisher',
                    category: 'Floor Polishers',
                    brand: 'Numatic HFT1530',
                    serial: 'NH1004',
                    purchaseDate: '2023-02-28',
                    cost: 380,
                    condition: 'Poor',
                    assignedTo: 'Sarah Wilson',
                    warranty: '2024-02-28',
                    supplier: 'Numatic Support'
                },
                {
                    itemId: 'EQ005',
                    name: 'Window Cleaning Kit',
                    category: 'Window Cleaning',
                    brand: 'Unger Professional',
                    serial: 'UP005',
                    purchaseDate: '2023-05-12',
                    cost: 150,
                    condition: 'Good',
                    assignedTo: 'Tom Brown',
                    warranty: '2024-05-12',
                    supplier: 'Unger UK'
                }
            ];

            APP_STATE.equipment = sampleEquipment;
            updateEquipmentDropdowns();
        }

        async function loadMaintenanceData() {
            const sampleMaintenance = [
                {
                    id: 'MNT001',
                    itemId: 'EQ001',
                    lastService: '2023-07-15',
                    nextDue: '2024-01-15',
                    type: 'Routine Maintenance',
                    provider: 'Dyson Service Center',
                    cost: 45,
                    description: 'Filter replacement and motor service'
                },
                {
                    id: 'MNT002',
                    itemId: 'EQ002',
                    lastService: '2023-09-20',
                    nextDue: '2024-03-20',
                    type: 'Emergency Repair',
                    provider: 'Local Repair Shop',
                    cost: 120,
                    description: 'Pump replacement due to failure'
                },
                {
                    id: 'MNT003',
                    itemId: 'EQ004',
                    lastService: '2023-11-28',
                    nextDue: '2024-05-28',
                    type: 'Routine Maintenance',
                    provider: 'Numatic Service',
                    cost: 85,
                    description: 'Motor brush replacement'
                }
            ];

            APP_STATE.maintenance = sampleMaintenance;
        }

        async function loadPATData() {
            const samplePAT = [
                {
                    id: 'PAT001',
                    itemId: 'EQ001',
                    lastTest: '2023-06-15',
                    nextDue: '2024-06-15',
                    result: 'Pass',
                    tester: 'John Electrician',
                    certificate: 'CERT-2023-001'
                },
                {
                    id: 'PAT002',
                    itemId: 'EQ002',
                    lastTest: '2023-05-20',
                    nextDue: '2024-05-20',
                    result: 'Pass',
                    tester: 'Jane Tester',
                    certificate: 'CERT-2023-002'
                },
                {
                    id: 'PAT003',
                    itemId: 'EQ004',
                    lastTest: '2023-03-28',
                    nextDue: '2024-03-28',
                    result: 'Fail',
                    tester: 'Sarah Tester',
                    certificate: 'CERT-2023-004'
                }
            ];

            APP_STATE.patTesting = samplePAT;
        }

        async function loadAlertsData() {
            const alerts = [];
            const today = new Date();
            const warningDate = new Date(today.getTime() + (30 * 24 * 60 * 60 * 1000));

            // Check maintenance due
            APP_STATE.maintenance.forEach(maintenance => {
                const dueDate = new Date(maintenance.nextDue);
                if (dueDate <= warningDate) {
                    const equipment = APP_STATE.equipment.find(eq => eq.itemId === maintenance.itemId);
                    alerts.push({
                        type: 'maintenance',
                        severity: dueDate < today ? 'danger' : 'warning',
                        title: 'Maintenance Due',
                        message: `${equipment?.name || maintenance.itemId} - Due: ${formatDate(dueDate)}`,
                        itemId: maintenance.itemId,
                        dueDate: dueDate
                    });
                }
            });

            // Check PAT tests due
            APP_STATE.patTesting.forEach(pat => {
                const dueDate = new Date(pat.nextDue);
                if (dueDate <= warningDate || pat.result === 'Fail') {
                    const equipment = APP_STATE.equipment.find(eq => eq.itemId === pat.itemId);
                    alerts.push({
                        type: 'pat',
                        severity: pat.result === 'Fail' ? 'danger' : (dueDate < today ? 'danger' : 'warning'),
                        title: pat.result === 'Fail' ? 'PAT Test Failed' : 'PAT Test Due',
                        message: `${equipment?.name || pat.itemId} - ${pat.result === 'Fail' ? 'FAILED TEST' : 'Due: ' + formatDate(dueDate)}`,
                        itemId: pat.itemId,
                        dueDate: dueDate
                    });
                }
            });

            // Check equipment condition
            APP_STATE.equipment.forEach(equipment => {
                if (['Poor', 'Requires Repair', 'Out of Service'].includes(equipment.condition)) {
                    alerts.push({
                        type: 'condition',
                        severity: equipment.condition === 'Out of Service' ? 'danger' : 'warning',
                        title: 'Equipment Condition Alert',
                        message: `${equipment.name} - Status: ${equipment.condition}`,
                        itemId: equipment.itemId
                    });
                }
            });

            APP_STATE.alerts = alerts;
        }

        function updateDashboard() {
            // Update stats
            document.getElementById('totalEquipment').textContent = APP_STATE.equipment.length;
            
            const maintenanceDue = APP_STATE.alerts.filter(alert => alert.type === 'maintenance').length;
            document.getElementById('maintenanceDue').textContent = maintenanceDue;
            
            const patDue = APP_STATE.alerts.filter(alert => alert.type === 'pat').length;
            document.getElementById('patDue').textContent = patDue;
            
            const totalValue = APP_STATE.equipment.reduce((sum, eq) => sum + (eq.cost || 0), 0);
            document.getElementById('totalValue').textContent = `¬£${totalValue.toLocaleString()}`;

            // Update recent alerts
            updateRecentAlerts();
        }

        function updateRecentAlerts() {
            const container = document.getElementById('recentAlerts');
            const recentAlerts = APP_STATE.alerts.slice(0, 5);

            if (recentAlerts.length === 0) {
                container.innerHTML = '<div style="padding: 20px; text-align: center; color: var(--text-secondary);">No active alerts</div>';
                return;
            }

            const alertsHTML = recentAlerts.map(alert => `
                <div class="alert alert-${alert.severity === 'danger' ? 'danger' : 'warning'}">
                    <strong>${alert.title}</strong>
                    <div>${alert.message}</div>
                </div>
            `).join('');

            container.innerHTML = alertsHTML;
        }

        function loadSectionData(section) {
            switch (section) {
                case 'equipment':
                    renderEquipmentTable();
                    break;
                case 'maintenance':
                    renderMaintenanceTable();
                    break;
                case 'pat-testing':
                    renderPATTable();
                    break;
                case 'alerts':
                    renderAlertsPage();
                    break;
            }
        }

        function renderEquipmentTable() {
            const container = document.getElementById('equipmentTable');
            
            if (APP_STATE.equipment.length === 0) {
                container.innerHTML = '<div class="loading">No equipment found</div>';
                return;
            }

            const tableHTML = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>Item ID</th>
                            <th>Name</th>
                            <th>Category</th>
                            <th>Condition</th>
                            <th>Assigned To</th>
                            <th>Purchase Cost</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${APP_STATE.equipment.map(equipment => `
                            <tr>
                                <td><strong>${equipment.itemId}</strong></td>
                                <td>${equipment.name}</td>
                                <td>${equipment.category}</td>
                                <td><span class="status-badge ${equipment.condition.toLowerCase()}">${equipment.condition}</span></td>
                                <td>${equipment.assignedTo || '-'}</td>
                                <td>¬£${equipment.cost?.toLocaleString() || '0'}</td>
                                <td>
                                    <button class="btn btn-outline" onclick="editEquipment('${equipment.itemId}')">Edit</button>
                                    <button class="btn btn-outline" onclick="viewEquipmentDetails('${equipment.itemId}')">View</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            container.innerHTML = tableHTML;
        }

        function renderMaintenanceTable() {
            const container = document.getElementById('maintenanceTable');
            
            if (APP_STATE.maintenance.length === 0) {
                container.innerHTML = '<div class="loading">No maintenance records found</div>';
                return;
            }

            const tableHTML = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Equipment</th>
                            <th>Last Service</th>
                            <th>Next Due</th>
                            <th>Type</th>
                            <th>Cost</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${APP_STATE.maintenance.map(maintenance => {
                            const equipment = APP_STATE.equipment.find(eq => eq.itemId === maintenance.itemId);
                            const isOverdue = new Date(maintenance.nextDue) < new Date();
                            return `
                                <tr ${isOverdue ? 'style="background-color: #fee2e2;"' : ''}>
                                    <td><strong>${maintenance.id}</strong></td>
                                    <td>${equipment?.name || maintenance.itemId}</td>
                                    <td>${formatDate(maintenance.lastService)}</td>
                                    <td>${formatDate(maintenance.nextDue)} ${isOverdue ? '<span style="color: red;">(OVERDUE)</span>' : ''}</td>
                                    <td>${maintenance.type}</td>
                                    <td>¬£${maintenance.cost?.toLocaleString() || '0'}</td>
                                    <td>
                                        <button class="btn btn-outline" onclick="editMaintenance('${maintenance.id}')">Edit</button>
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            `;

            container.innerHTML = tableHTML;
        }

        function renderPATTable() {
            const container = document.getElementById('patTable');
            
            if (APP_STATE.patTesting.length === 0) {
                container.innerHTML = '<div class="loading">No PAT testing records found</div>';
                return;
            }

            const tableHTML = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>Test ID</th>
                            <th>Equipment</th>
                            <th>Last Test</th>
                            <th>Next Due</th>
                            <th>Result</th>
                            <th>Tester</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${APP_STATE.patTesting.map(pat => {
                            const equipment = APP_STATE.equipment.find(eq => eq.itemId === pat.itemId);
                            const isOverdue = new Date(pat.nextDue) < new Date();
                            const isFailed = pat.result === 'Fail';
                            return `
                                <tr ${isFailed || isOverdue ? 'style="background-color: #fee2e2;"' : ''}>
                                    <td><strong>${pat.id}</strong></td>
                                    <td>${equipment?.name || pat.itemId}</td>
                                    <td>${formatDate(pat.lastTest)}</td>
                                    <td>${formatDate(pat.nextDue)} ${isOverdue ? '<span style="color: red;">(OVERDUE)</span>' : ''}</td>
                                    <td><span class="status-badge ${pat.result.toLowerCase()}">${pat.result}</span></td>
                                    <td>${pat.tester}</td>
                                    <td>
                                        <button class="btn btn-outline" onclick="editPATTest('${pat.id}')">Edit</button>
                                        ${isFailed ? '<button class="btn btn-danger" onclick="retestEquipment(\'' + pat.itemId + '\')">Retest</button>' : ''}
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            `;

            container.innerHTML = tableHTML;
        }

        function renderAlertsPage() {
            const container = document.getElementById('alertsContent');
            
            if (APP_STATE.alerts.length === 0) {
                container.innerHTML = '<div class="loading">No active alerts</div>';
                return;
            }

            // Group alerts by type
            const groupedAlerts = {
                maintenance: APP_STATE.alerts.filter(alert => alert.type === 'maintenance'),
                pat: APP_STATE.alerts.filter(alert => alert.type === 'pat'),
                condition: APP_STATE.alerts.filter(alert => alert.type === 'condition')
            };

            const alertsHTML = `
                <div class="dashboard-grid">
                    ${Object.entries(groupedAlerts).map(([type, alerts]) => {
                        if (alerts.length === 0) return '';
                        
                        const typeLabels = {
                            maintenance: 'üîß Maintenance Alerts',
                            pat: '‚ö° PAT Testing Alerts',
                            condition: 'üö® Condition Alerts'
                        };

                        return `
                            <div class="table-container">
                                <div class="table-header">
                                    <h3 class="table-title">${typeLabels[type]} (${alerts.length})</h3>
                                </div>
                                <div style="padding: 20px;">
                                    ${alerts.map(alert => `
                                        <div class="alert alert-${alert.severity === 'danger' ? 'danger' : 'warning'}" style="margin-bottom: 12px;">
                                            <strong>${alert.title}</strong>
                                            <div>${alert.message}</div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;

            container.innerHTML = alertsHTML;
        }

        function updateEquipmentDropdowns() {
            const selects = ['maintenanceEquipment', 'patEquipment'];
            
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                select.innerHTML = '<option value="">Select Equipment</option>';
                
                APP_STATE.equipment.forEach(equipment => {
                    const option = document.createElement('option');
                    option.value = equipment.itemId;
                    option.textContent = `${equipment.itemId} - ${equipment.name}`;
                    select.appendChild(option);
                });
            });
        }

        // Modal Functions
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Action Functions
        function addEquipment() {
            document.getElementById('addEquipmentForm').reset();
            openModal('addEquipmentModal');
        }

        function logMaintenance() {
            document.getElementById('maintenanceForm').reset();
            document.getElementById('maintenanceDate').value = new Date().toISOString().split('T')[0];
            openModal('maintenanceModal');
        }

        function recordPATTest() {
            document.getElementById('patForm').reset();
            document.getElementById('patDate').value = new Date().toISOString().split('T')[0];
            openModal('patModal');
        }

        // Form Handlers
        function handleAddEquipment(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const equipment = {
                itemId: generateItemID(),
                name: document.getElementById('equipmentName').value,
                category: document.getElementById('equipmentCategory').value,
                brand: document.getElementById('equipmentBrand').value,
                serial: document.getElementById('equipmentSerial').value,
                purchaseDate: document.getElementById('equipmentPurchaseDate').value,
                cost: parseFloat(document.getElementById('equipmentCost').value) || 0,
                condition: document.getElementById('equipmentCondition').value,
                assignedTo: document.getElementById('equipmentAssigned').value,
                warranty: document.getElementById('equipmentWarranty').value,
                supplier: document.getElementById('equipmentSupplier').value
            };

            // Add to local state (in real app, would sync with Google Sheets)
            APP_STATE.equipment.push(equipment);
            updateEquipmentDropdowns();
            
            if (APP_STATE.currentSection === 'equipment') {
                renderEquipmentTable();
            }
            
            closeModal('addEquipmentModal');
            showToast('Equipment added successfully!', 'success');
            
            // Simulate sync with Google Sheets
            syncEquipmentToSheets(equipment);
        }

        function handleLogMaintenance(e) {
            e.preventDefault();
            
            const maintenance = {
                id: generateMaintenanceID(),
                itemId: document.getElementById('maintenanceEquipment').value,
                lastService: document.getElementById('maintenanceDate').value,
                nextDue: calculateNextDueDate(document.getElementById('maintenanceDate').value, 6), // 6 months
                type: document.getElementById('maintenanceType').value,
                provider: document.getElementById('maintenanceProvider').value,
                cost: parseFloat(document.getElementById('maintenanceCost').value) || 0,
                description: document.getElementById('maintenanceDescription').value,
                parts: document.getElementById('maintenanceParts').value,
                invoice: document.getElementById('maintenanceInvoice').value,
                notes: document.getElementById('maintenanceNotes').value
            };

            APP_STATE.maintenance.push(
                    